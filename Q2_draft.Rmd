---
title: "Rough Draft Q2"
output:
  pdf_document: default
  html_document: default
---



```{r, include=FALSE}
library(tidyverse)
library(caret)
library(leaps)
library(MASS)
library(car)
# regression selection
library(olsrr)
library(forecast)

```



# Considering the constraint of the Climate Change Act and other government targets, produce a model forecasting the carbon emissions of the evolving profile of vehicles on the UK road network. 


```{r}
# load data
all <- read.csv("GB_all_data.csv")
colnames(all)[1] <- "Year"

# take the date out - this new df will be used for subset regression coming up
df <- all[,-c(1, 2, 3)]

# remove 2019
df <- df[1:25,]

# turn into df 
df <- data.frame(df)
```



```{r}
# use all predictors
m1 <- lm(Total_GHGs ~., data = df)
```


## 1.) Best subset regression selection

**The number of models that this procedure fits multiplies quickly. If you have 10 independent variables, it fits 1024 models. However, if you have 20 variables, it fits 1,048,576 models**

```{r, warning=FALSE}
# https://statisticsbyjim.com/regression/guide-stepwise-best-subsets-regression/
# https://olsrr.rsquaredacademy.com/articles/variable_selection.html
# change the ols() function, there are cool ones to pick from
ols_step_best_subset(m1)
```

**This takes a very long time if you use all 14 X variables.**





```{r}
# based on OLS results we selected these two variables
m2 <- lm(Total_GHGs ~ Hybrid_Electric + Range_Extended_Electric + Total_Vehicles, data = df)

# check out model
summary(m2)

# https://www.researchgate.net/post/How_high_of_VIF_value_in_regression_can_be_accepted
# check for colinearity
vif(m2)

```




### A VIF above 5 is not good, a VIF above 10 is very bad, so we will go to the 2 X-variable model, which is Unemployment_rate Total_Production = Yhat.



```{r}
# based on OLS results we selected these two variables
m3 <- lm(Total_GHGs ~ Unemployment_rate + Total_Production, data = df)

# check out model
summary(m3)

# https://www.researchgate.net/post/How_high_of_VIF_value_in_regression_can_be_accepted
# check for colinearity
vif(m3)
```

## 2.) Forecasting our X variables
https://otexts.com/fpp2/the-forecast-package-in-r.html

**If the first argument is of class ts, it returns forecasts from the automatic ETS algorithm discussed in Chapter 7.**


```{r}
# use only needed data
future_df <- all[,c("Year", "Unemployment_rate", "Total_Production")]

# turn into time series data
future_df <- ts(future_df)

# forecast 4 ahead (4 is arbitrary)
fore_df <- forecast(future_df, h = 4) %>% data.frame()

# keep only point forecast
fore_df <- fore_df[,1:3]

# turn df into long shape
fore_df_long <- pivot_wider(fore_df, names_from = Series, values_from = Point.Forecast)
```



```{r}
coef(m3)
```

**Now add those to df as constants.**


```{r}
fore_df_long$Intercept <- 34168.6941
fore_df_long$UR_coef <- -600.2673
fore_df_long$TP_coef <- 841.9804
```


## 3.) Final predictions 

```{r}
# predictions
final <- fore_df_long %>%
  mutate(Y_hat = (Intercept + (Unemployment_rate * UR_coef) + (Total_Production  * TP_coef)))


head(final)
```


```{r}
# just see the predicted values
print(final$Y_hat)
```


**From 2015 - 2018 our data was**
* 111,973.846
* 114,585.172
* 114,785.965
* 113,280.299


### Thoughts
* To be honest, not a big fan of using total production for an X variable. Maybe a lag variable instead? 
* Changing the forecasting approach. This was just a quick example
* X columns with a lot of 0's? not sure it's good to have, if okay to have we can add other ones such as Electric charging points



